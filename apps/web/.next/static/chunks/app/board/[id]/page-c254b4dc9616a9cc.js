(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[444],{3800:function(e,t,a){Promise.resolve().then(a.bind(a,339))},339:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var s=a(6591),r=a(3466),l=a(6285),n=a(3168),i=a(808),o=a(56),d=a(5749),c=a(1035),u=a(6841),m=a(3413),x=a(999),f=a(3937);function h(e){let{task:t,isOverlay:a}=e,r=(0,m.NL)(),{setNodeRef:n,attributes:i,listeners:h,transform:b,transition:v,isDragging:p}=(0,o.nB)({id:t.id,data:{type:"Task",task:t}}),g=(0,x.D)({mutationFn:async()=>{await l.h.delete("/kanban/tasks/".concat(t.id))},onSuccess:()=>{f.default.success("Tarefa exclu\xedda!"),r.invalidateQueries()},onError:()=>f.default.error("Erro ao excluir a tarefa.")}),j={transform:d.ux.Transform.toString(b),transition:v,opacity:p&&!a?.3:1};return(0,s.jsxs)("div",{ref:n,style:j,className:"group bg-white p-3 rounded-xl shadow-sm border flex gap-2 items-start relative\n        ".concat(a?"border-blue-500 shadow-xl rotate-2 scale-105 z-50":"border-slate-200 hover:border-blue-300 mb-3","\n      "),children:[(0,s.jsx)("div",{...i,...h,className:"mt-0.5 text-slate-300 hover:text-blue-500 cursor-grab active:cursor-grabbing outline-none touch-none",children:(0,s.jsx)(c.Z,{size:16})}),(0,s.jsx)("div",{className:"flex-1 pr-6",children:(0,s.jsx)("p",{className:"text-sm font-medium text-slate-800 leading-snug break-words",children:t.title})}),!a&&(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),confirm("Tem certeza que deseja excluir esta tarefa?")&&g.mutate()},className:"absolute right-2 top-3 text-slate-300 hover:text-red-500 hover:bg-red-50 p-1.5 rounded-md transition-colors opacity-0 group-hover:opacity-100",title:"Excluir Tarefa",children:(0,s.jsx)(u.Z,{size:14})})]})}var b=a(8646);function v(e){var t;let{column:a,boardId:r}=e,{setNodeRef:d}=(0,i.Zj)({id:a.id,data:{type:"Column",column:a}}),[c,u]=(0,n.useState)(!1),[v,p]=(0,n.useState)(""),g=(0,m.NL)(),j=(0,x.D)({mutationFn:async e=>{var t;let s=(null===(t=a.tasks)||void 0===t?void 0:t.length)>0?a.tasks[a.tasks.length-1].order+1e3:1e3;await l.h.post("/kanban/tasks",{title:e,columnId:a.id,order:s})},onSuccess:()=>{f.default.success("Tarefa criada!"),g.invalidateQueries({queryKey:["board",r]}),u(!1),p("")},onError:()=>f.default.error("Falha ao criar tarefa.")});return(0,s.jsxs)("div",{className:"bg-slate-100/90 rounded-2xl w-[320px] shrink-0 flex flex-col max-h-full border border-slate-200 shadow-sm",children:[(0,s.jsxs)("div",{className:"p-4 flex items-center justify-between border-b border-slate-200/60 bg-slate-100/50 rounded-t-2xl",children:[(0,s.jsx)("h3",{className:"font-semibold text-slate-800 tracking-tight",children:a.title}),(0,s.jsx)("span",{className:"bg-white border border-slate-200 text-slate-600 text-xs px-2 py-0.5 rounded-full font-bold",children:(null===(t=a.tasks)||void 0===t?void 0:t.length)||0})]}),(0,s.jsxs)("div",{ref:d,className:"flex-1 overflow-y-auto p-3 min-h-[150px] scrollbar-thin",children:[(0,s.jsx)(o.Fo,{items:(a.tasks||[]).map(e=>e.id),strategy:o.qw,children:(a.tasks||[]).map(e=>(0,s.jsx)(h,{task:e},e.id))}),c?(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),v.trim()&&j.mutate(v)},className:"mt-1",children:[(0,s.jsx)("input",{autoFocus:!0,value:v,onChange:e=>p(e.target.value),placeholder:"O que ser\xe1 feito?",className:"w-full text-sm px-3 py-2.5 border border-slate-300 shadow-sm rounded-xl outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all"}),(0,s.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,s.jsx)("button",{type:"submit",disabled:j.isPending,className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-lg hover:bg-blue-700 font-medium transition-colors",children:"Salvar"}),(0,s.jsx)("button",{type:"button",onClick:()=>u(!1),className:"text-slate-500 hover:text-slate-800 hover:bg-slate-200 text-xs px-3 py-2 rounded-lg font-medium transition-colors",children:"Cancelar"})]})]}):(0,s.jsxs)("button",{onClick:()=>u(!0),className:"flex items-center gap-2 text-sm text-slate-500 hover:text-slate-800 w-full p-2.5 hover:bg-slate-200/70 border border-dashed border-transparent hover:border-slate-300 rounded-xl transition-all mt-1 font-medium",children:[(0,s.jsx)(b.Z,{size:18})," Adicionar Cart\xe3o"]})]})]})}var p=a(746);function g(e){let{initialData:t}=e,[a,r]=(0,n.useState)(t),[d,c]=(0,n.useState)(null),u=(0,m.NL)();(0,n.useEffect)(()=>{r(t)},[t]),(0,n.useEffect)(()=>{let e=(0,p.io)("http://localhost:3001",{withCredentials:!0,transports:["websocket"]});return e.on("boardUpdated",()=>u.invalidateQueries({queryKey:["board",a.id]})),()=>{e.disconnect()}},[a.id,u]);let g=(0,i.Dy)((0,i.VT)(i.we,{activationConstraint:{distance:5}})),j=(0,x.D)({mutationFn:async e=>{let{taskId:t,data:a}=e;await l.h.patch("/kanban/tasks/".concat(t),a)},onError:()=>{f.default.error("Erro de conex\xe3o ao salvar movimento."),u.invalidateQueries({queryKey:["board",a.id]})},onSettled:()=>u.invalidateQueries({queryKey:["board",a.id]})}),k=(0,x.D)({mutationFn:async e=>{var t;let s=(null===(t=a.columns)||void 0===t?void 0:t.length)>0?a.columns[a.columns.length-1].order+1e3:1e3;await l.h.post("/kanban/columns",{title:e,boardId:a.id,order:s})},onSuccess:()=>{f.default.success("Lista criada com sucesso!"),u.invalidateQueries({queryKey:["board",a.id]})},onError:()=>f.default.error("Falha ao criar nova lista.")});return(0,s.jsxs)(i.LB,{sensors:g,collisionDetection:i.ey,onDragStart:e=>{var t;(null===(t=e.active.data.current)||void 0===t?void 0:t.type)==="Task"&&c(e.active.data.current.task)},onDragOver:e=>{var t,a;let{active:s,over:l}=e;if(!l||s.id===l.id||(null===(t=s.data.current)||void 0===t?void 0:t.type)!=="Task")return;let n=(null===(a=l.data.current)||void 0===a?void 0:a.type)==="Column";r(e=>{let t=(e.columns||[]).findIndex(e=>(e.tasks||[]).some(e=>e.id===s.id)),a=n?(e.columns||[]).findIndex(e=>e.id===l.id):(e.columns||[]).findIndex(e=>(e.tasks||[]).some(e=>e.id===l.id));if(-1===t||-1===a||t===a)return e;let r=[...e.columns],i=r[t].tasks.find(e=>e.id===s.id);r[t]={...r[t],tasks:r[t].tasks.filter(e=>e.id!==s.id)};let o=[...r[a].tasks];if(n)o.push({...i,columnId:r[a].id});else{let e=o.findIndex(e=>e.id===l.id),t=l&&s.rect.current.translated&&s.rect.current.translated.top>l.rect.top+l.rect.height?1:0;o.splice(e+t,0,{...i,columnId:r[a].id})}return r[a]={...r[a],tasks:o},{...e,columns:r}})},onDragEnd:e=>{var t,s;c(null);let{active:l,over:n}=e;if(!n)return;let i=(a.columns||[]).find(e=>(e.tasks||[]).some(e=>e.id===l.id)),d=(a.columns||[]).find(e=>e.id===n.id)||(a.columns||[]).find(e=>(e.tasks||[]).some(e=>e.id===n.id));if(!i||!d)return;let u=[...d.tasks],m=u.findIndex(e=>e.id===l.id);if(i.id===d.id){let e=u.findIndex(e=>e.id===l.id),t=u.findIndex(e=>e.id===n.id);e!==t&&(u=(0,o.Rp)(u,e,t),m=t,r(e=>({...e,columns:e.columns.map(e=>e.id===d.id?{...e,tasks:u}:e)})))}let x=u[m];if(!x)return;let f=null===(t=u[m-1])||void 0===t?void 0:t.order,h=null===(s=u[m+1])||void 0===s?void 0:s.order,b=void 0===f&&void 0===h?1e3:void 0===f?h/2:void 0===h?f+1e3:(f+h)/2;(i.id!==d.id||b!==x.order)&&j.mutate({taskId:l.id,data:{columnId:d.id,order:b}})},children:[(0,s.jsxs)("div",{className:"flex gap-6 h-full items-start overflow-x-auto pb-4",children:[(a.columns||[]).map(e=>(0,s.jsx)(v,{column:e,boardId:a.id},e.id)),(0,s.jsxs)("button",{onClick:()=>{let e=prompt("Nome da Nova Lista:");e&&e.trim()&&k.mutate(e)},className:"shrink-0 w-80 bg-slate-200/50 hover:bg-white border-2 border-dashed border-slate-300 hover:border-blue-400 hover:text-blue-600 rounded-2xl flex items-center justify-center gap-2 text-slate-500 font-medium transition-all h-[100px]",children:[(0,s.jsx)(b.Z,{size:20})," Criar Nova Lista"]})]}),(0,s.jsx)(i.y9,{children:d?(0,s.jsx)(h,{task:d,isOverlay:!0}):null})]})}var j=a(2782),k=a(3330),y=a(342),w=a(5556),N=a(1569);function C(){let{id:e}=(0,j.useParams)(),t=(0,j.useRouter)(),{data:a,isLoading:i,isError:o}=(0,r.a)({queryKey:["board",e],queryFn:async()=>(await l.h.get("/kanban/board/".concat(e))).data,retry:!1});return((0,n.useEffect)(()=>{o&&t.replace("/")},[o,t]),i)?(0,s.jsxs)("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center text-slate-500 font-medium gap-3",children:[(0,s.jsx)(y.Z,{className:"animate-spin text-blue-500",size:28})," Sincronizando quadro colaborativo..."]}):a?(0,s.jsxs)("div",{className:"h-screen bg-slate-50 flex flex-col overflow-hidden",children:[(0,s.jsxs)("header",{className:"bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between shadow-sm shrink-0 z-10",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(k.default,{href:"/",className:"text-slate-400 hover:text-blue-600 transition-colors p-2 hover:bg-blue-50 rounded-full",children:(0,s.jsx)(w.Z,{size:20})}),(0,s.jsx)("div",{className:"h-6 w-px bg-slate-200"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-blue-600",children:[(0,s.jsx)(N.Z,{size:24}),(0,s.jsx)("h1",{className:"text-xl font-bold text-slate-900 tracking-tight",children:a.name})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-emerald-50 border border-emerald-200 px-3 py-1.5 rounded-full text-xs font-bold text-emerald-700 shadow-sm",children:[(0,s.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-emerald-500 animate-pulse"})," Sincroniza\xe7\xe3o em Tempo Real"]})]}),(0,s.jsx)("main",{className:"flex-1 p-6 overflow-x-auto overflow-y-hidden bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]",children:(0,s.jsx)(g,{initialData:a})})]}):null}},6285:function(e,t,a){"use strict";a.d(t,{h:function(){return s}});let s=a(7264).Z.create({baseURL:"http://localhost:3001",withCredentials:!0})}},function(e){e.O(0,[789,831,451,352,937,375,443,686,744],function(){return e(e.s=3800)}),_N_E=e.O()}]);